{"version":3,"sources":["../../../lib/mingo_ex.js"],"names":["mingo","require","jsexpr","EV_CACHE","EX_CACHE","addOperators","OP_QUERY","_","$starts","selector","value","args","Array","isArray","startsWith","$startsWith","$ends","endsWith","$endsWith","$contains","indexOf","OP_EXPRESSION","$eval","eval","$expr","expr","$keyval","val","computeValue","reduce","map","item","$trim","chars","Set","split","input","has","shift","length","pop","join","$startsWidth","module","exports"],"mappings":"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","file":"mingo_ex.js","sourcesContent":["const\r\n\tmingo = require('mingo'),\r\n\tjsexpr = require('./expression')('$');\r\n\r\nconst EV_CACHE = {};\r\nconst EX_CACHE = {};\r\n\r\nmingo.addOperators(mingo.OP_QUERY, function (_) {\r\n\treturn {\r\n\t\t$starts(selector, value, args) {\r\n\t\t\targs = Array.isArray(args) ? args : [args];\r\n\t\t\treturn (value || \"\").startsWith(args[0]);\r\n\t\t},\r\n\t\t$startsWith(selector, value, args) {\r\n\t\t\targs = Array.isArray(args) ? args : [args];\r\n\t\t\treturn (value || \"\").startsWith(args[0]);\r\n\t\t},\r\n\t\t$ends(selector, value, args) {\r\n\t\t\targs = Array.isArray(args) ? args : [args];\r\n\t\t\treturn (value || \"\").endsWith(args[0]);\r\n\t\t},\r\n\t\t$endsWith(selector, value, args) {\r\n\t\t\targs = Array.isArray(args) ? args : [args];\r\n\t\t\treturn (value || \"\").endsWith(args[0]);\r\n\t\t},\r\n\t\t$contains(selector, value, args) {\r\n\t\t\targs = Array.isArray(args) ? args : [args];\r\n\t\t\treturn (value || \"\").indexOf(args[0]) >= 0;\r\n\t\t}\r\n\t};\r\n});\r\n\r\nmingo.addOperators(mingo.OP_EXPRESSION, function (_) {\r\n\treturn {\r\n\t\t$eval(selector, value, args) {\r\n\t\t\tif (!EV_CACHE[value]) {\r\n\t\t\t\tEV_CACHE[value] = jsexpr.eval(value);\r\n\t\t\t}\r\n\t\t\treturn EV_CACHE[value](selector);\r\n\t\t},\r\n\t\t$expr(selector, value, args) {\r\n\t\t\tif (!EX_CACHE[value]) {\r\n\t\t\t\tEX_CACHE[value] = jsexpr.expr(value);\r\n\t\t\t}\r\n\t\t\treturn EX_CACHE[value](selector);\r\n\t\t},\r\n\t\t$keyval(selector, value, args) {\r\n\t\t\tlet val = _.computeValue(selector, value);\r\n\t\t\treturn val.reduce((map, item) => {\r\n\t\t\t\tmap[item[0]] = item[1] || \"_\";\r\n\t\t\t\treturn map;\r\n\t\t\t}, {});\r\n\t\t},\r\n\t\t$trim(selector, value, args) {\r\n\t\t\tlet chars = new Set((value.chars || '').split(''));\r\n\t\t\tlet val = _.computeValue(selector, value.input).split('');\r\n\t\t\twhile (chars.has(val[0])) val.shift();\r\n\t\t\twhile (chars.has(val[val.length - 1])) val.pop();\r\n\t\t\treturn val.join('');\r\n\t\t},\r\n\t\t$starts(selector, value, args) {\r\n\t\t\tlet val = _.computeValue(selector, value[0]);\r\n\t\t\treturn (val || \"\").startsWith(value[1]);\r\n\t\t},\r\n\t\t$startsWidth(selector, value, args) {\r\n\t\t\tlet val = _.computeValue(selector, value[0]);\r\n\t\t\treturn (val || \"\").startsWith(value[1]);\r\n\t\t},\r\n\t\t$ends(selector, value, args) {\r\n\t\t\tlet val = _.computeValue(selector, value[0]);\r\n\t\t\treturn (val || \"\").endsWith(value[1]);\r\n\t\t},\r\n\t\t$endsWith(selector, value, args) {\r\n\t\t\tlet val = _.computeValue(selector, value[0]);\r\n\t\t\treturn (val || \"\").endsWith(value[1]);\r\n\t\t},\r\n\t\t$contains(selector, value, args) {\r\n\t\t\tlet val = _.computeValue(selector, value[0]);\r\n\t\t\treturn (val || \"\").indexOf(value[1]) >= 0;\r\n\t\t}\r\n\t};\r\n});\r\n\r\n\r\nmodule.exports = mingo;\r\n"]}