{"version":3,"sources":["../../../lib/mingo_ex.js"],"names":["mingo","require","jsexpr","EV_CACHE","EX_CACHE","addOperators","OP_QUERY","_","$starts","selector","value","args","Array","isArray","startsWith","$startsWith","$ends","endsWith","$endsWith","$contains","indexOf","OP_EXPRESSION","$eval","eval","$expr","expr","$keyval","val","computeValue","reduce","map","item","$trim","chars","Set","split","input","has","shift","length","pop","join","$startsWidth","err","module","exports"],"mappings":"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","file":"mingo_ex.js","sourcesContent":["const\r\n\tmingo = require('mingo'),\r\n\tjsexpr = require('./expression')('$');\r\n\r\nconst EV_CACHE = {};\r\nconst EX_CACHE = {};\r\n\r\ntry {\r\n\tmingo.addOperators(mingo.OP_QUERY, function (_) {\r\n\t\treturn {\r\n\t\t\t$starts(selector, value, args) {\r\n\t\t\t\targs = Array.isArray(args) ? args : [args];\r\n\t\t\t\treturn (value || \"\").startsWith(args[0]);\r\n\t\t\t},\r\n\t\t\t$startsWith(selector, value, args) {\r\n\t\t\t\targs = Array.isArray(args) ? args : [args];\r\n\t\t\t\treturn (value || \"\").startsWith(args[0]);\r\n\t\t\t},\r\n\t\t\t$ends(selector, value, args) {\r\n\t\t\t\targs = Array.isArray(args) ? args : [args];\r\n\t\t\t\treturn (value || \"\").endsWith(args[0]);\r\n\t\t\t},\r\n\t\t\t$endsWith(selector, value, args) {\r\n\t\t\t\targs = Array.isArray(args) ? args : [args];\r\n\t\t\t\treturn (value || \"\").endsWith(args[0]);\r\n\t\t\t},\r\n\t\t\t$contains(selector, value, args) {\r\n\t\t\t\targs = Array.isArray(args) ? args : [args];\r\n\t\t\t\treturn (value || \"\").indexOf(args[0]) >= 0;\r\n\t\t\t}\r\n\t\t};\r\n\t});\r\n\t\r\n\tmingo.addOperators(mingo.OP_EXPRESSION, function (_) {\r\n\t\treturn {\r\n\t\t\t$eval(selector, value, args) {\r\n\t\t\t\tif (!EV_CACHE[value]) {\r\n\t\t\t\t\tEV_CACHE[value] = jsexpr.eval(value);\r\n\t\t\t\t}\r\n\t\t\t\treturn EV_CACHE[value](selector);\r\n\t\t\t},\r\n\t\t\t$expr(selector, value, args) {\r\n\t\t\t\tif (!EX_CACHE[value]) {\r\n\t\t\t\t\tEX_CACHE[value] = jsexpr.expr(value);\r\n\t\t\t\t}\r\n\t\t\t\treturn EX_CACHE[value](selector);\r\n\t\t\t},\r\n\t\t\t$keyval(selector, value, args) {\r\n\t\t\t\tlet val = _.computeValue(selector, value);\r\n\t\t\t\treturn val.reduce((map, item) => {\r\n\t\t\t\t\tmap[item[0]] = item[1] || \"_\";\r\n\t\t\t\t\treturn map;\r\n\t\t\t\t}, {});\r\n\t\t\t},\r\n\t\t\t$trim(selector, value, args) {\r\n\t\t\t\tlet chars = new Set((value.chars || '').split(''));\r\n\t\t\t\tlet val = _.computeValue(selector, value.input).split('');\r\n\t\t\t\twhile (chars.has(val[0])) val.shift();\r\n\t\t\t\twhile (chars.has(val[val.length - 1])) val.pop();\r\n\t\t\t\treturn val.join('');\r\n\t\t\t},\r\n\t\t\t$starts(selector, value, args) {\r\n\t\t\t\tlet val = _.computeValue(selector, value[0]);\r\n\t\t\t\treturn (val || \"\").startsWith(value[1]);\r\n\t\t\t},\r\n\t\t\t$startsWidth(selector, value, args) {\r\n\t\t\t\tlet val = _.computeValue(selector, value[0]);\r\n\t\t\t\treturn (val || \"\").startsWith(value[1]);\r\n\t\t\t},\r\n\t\t\t$ends(selector, value, args) {\r\n\t\t\t\tlet val = _.computeValue(selector, value[0]);\r\n\t\t\t\treturn (val || \"\").endsWith(value[1]);\r\n\t\t\t},\r\n\t\t\t$endsWith(selector, value, args) {\r\n\t\t\t\tlet val = _.computeValue(selector, value[0]);\r\n\t\t\t\treturn (val || \"\").endsWith(value[1]);\r\n\t\t\t},\r\n\t\t\t$contains(selector, value, args) {\r\n\t\t\t\tlet val = _.computeValue(selector, value[0]);\r\n\t\t\t\treturn (val || \"\").indexOf(value[1]) >= 0;\r\n\t\t\t}\r\n\t\t};\r\n\t});\r\n}catch(err) {\r\n\t\r\n}\r\n\r\n\r\nmodule.exports = mingo;\r\n"]}