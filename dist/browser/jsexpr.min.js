/*! jsexpr 2021-06-02 */

"use strict";var _typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function o(i,a,s){function c(n,t){if(!a[n]){if(!i[n]){var r="function"==typeof require&&require;if(!t&&r)return r(n,!0);if(f)return f(n,!0);var e=new Error("Cannot find module '"+n+"'");throw e.code="MODULE_NOT_FOUND",e}var u=a[n]={exports:{}};i[n][0].call(u.exports,function(t){return c(i[n][1][t]||t)},u,u.exports,o,i,a,s)}return a[n].exports}for(var f="function"==typeof require&&require,t=0;t<s.length;t++)c(s[t]);return c}({1:[function(n,r,e){(function(){this.jsexpr;var t=n("./index.js");void 0!==e&&(void 0!==r&&r.exports&&(e=r.exports=t),e.jsexpr=t),"undefined"!=typeof window&&(window.jsexpr=t)}).call(this)},{"./index.js":2}],2:[function(t,n,r){var e=t("./lib");n.exports=e},{"./lib":4}],3:[function(require,module,exports){var extend=require("extend"),Mingo=require("mingo");function instance(token){var RX=new RegExp("\\"+token+"\\{[^\\}]+\\}","g"),RX_RPL_PARSE=new RegExp("\\"+token+"\\{([^\\}]+)\\}"),RX_RPL_TOKEN=new RegExp("\\"+token+"\\{|\\}","g"),RX_JSON_TOKEN=new RegExp("^\\"+token+"\\{JSON(:(\\d+|([^:]+(:(\\d+))?)))?\\}$"),CACHE={};function cacheeval(obj,key){if(!CACHE[key]){var rkey=key.replace(/'/g,"\\'"),rx=/^[a-zA-Z$_@]/,fn=eval("(function(){\n\t\t\t\tlet rx = /^[a-zA-Z$_]/;\n\t\t\t\treturn '"+rkey+"'.startsWith('this.') || '"+rkey+"'=='this' || !rx.test('"+rkey+"')?\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tlet r = undefined;\n\t\t\t\t\t\ttry {r="+key+";}\n\t\t\t\t\t\tcatch(err){}\n\t\t\t\t\t\treturn r;\n\t\t\t\t\t} :\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tlet r = undefined;\n\t\t\t\t\t\ttry {r=this."+(rx.test(key)?key:"$___$")+";}\n\t\t\t\t\t\tcatch(err){try{r="+key+";}catch(err){}}\n\t\t\t\t\t\treturn r;\n\t\t\t\t\t}\n\t\t\t})()");CACHE[key]=fn}return CACHE[key].call(obj)}function fneval(obj,key){try{return eval("this."+key)}catch(t){return}}function fnassign(path){return eval("(function(path){\n\t\t\treturn function(obj,val) {\n\t\t\t\ttry {\n\t\t\t\t\t// Ensure path\n\t\t\t\t\tlet root = obj;\n\t\t\t\t\tlet kpath = path.split('.');\n\t\t\t\t\tfor(let i=0; i<kpath.length;i++) {\n\t\t\t\t\t\tlet k = kpath[i];\n\t\t\t\t\t\tif(!root[k]) root[k] = {};\n\t\t\t\t\t\troot = root[k];\n\t\t\t\t\t}\n\n\t\t\t\t\treturn obj."+path+" = val;\n\t\t\t\t}catch(err) {}\n\t\t\t}\n\t\t})('"+path+"')")}var EVALS={eval:function(t,n){var r=fneval.call(t,t,n);return void 0===r?"":r},iteval:function(n,t){t.split(".").forEach(function(t){null!=n&&null!=n&&(n=n[t])});var r=n||void 0;return void 0===r?"":r},ceval:function(t,n){var r=cacheeval(t,n);return void 0===r?"":r},valwalk:function(t,n,r){if(!t)return t;for(var e in t){var u=r+(r?".":"")+e,o=n[u];void 0!==o?t[e]=o:"object"==_typeof2(t[e])&&EVALS.valwalk(t[e],n,u)}return t}};function parse(r,n){n=n||"ceval";var t=r.match(RX);t&&t.forEach(function(t){var n=t.replace(RX_RPL_PARSE,"$1").trim().replace(/'/g,"\\'");r=r.replace(t,"__val(entry,'"+n+"')")});var e=new Function("entry","__val","return ("+r+")");return function(t){return e(t,EVALS[n])}}function tokens(u,o){if(o=EVALS[o||"ceval"],RX_JSON_TOKEN.test(u)){var t=u.replace(RX_RPL_TOKEN,"").split(":"),n=t[1],r=t[2];2==t.length?r=isNaN(n)?2:(n="this",t[1]):1==t.length&&(n="this",r=2),r=parseInt(r);var e=tokens("${"+n+"}");return function(t){return JSON.stringify(e(t),null,r)}}var i,a=[];return(u.match(RX)||[]).forEach(function(t){var n=u.indexOf(t),r=u.substring(0,n),e=t.replace(RX_RPL_TOKEN,"");u=u.substring(n+t.length),a.push(r),a.push(function(t){return o(t,e)})}),a.push(u),a=a.filter(function(t){return""!=t}),1<(i=a.length)?function(t){for(var n="",r=0;r<i;r++){var e=a[r];n+="string"==typeof e?e:e(t)}return n}:function(t){var n=a[0];return"string"==typeof n?n:n(t)}}function jsontokens(u){var o,i=[];return function e(u,o){u&&Object.keys(u).forEach(function(t){var n=o+(o?".":"")+t,r=u[t];"string"==typeof r?i.push({path:n,fn:tokens(r)}):e(r,n)})}(u,""),o=i.length,function(t){for(var n={},r=0;r<o;r++){var e=i[r];n[e.path]=e.fn(t)}return EVALS.valwalk(extend(!0,{},u),n,"")}}function mingotokens(t){var n=Array.isArray(t.$)?t.$:[t.$],e=new Mingo.Aggregator(n);return function(t){var n=Array.isArray(t),r=e.run(n?t:[t]);return!n&&r.length<=1?r[0]:r}}function exprfn(n,t){if("number"==typeof n)return function(t){return n};if("object"!=(void 0===n?"undefined":_typeof2(n)))return tokens(n);var r=extend({},n);delete r.$;var e=n.$?mingotokens(n,t):function(t){return t},u=Object.keys(r).length?jsontokens(r,t):function(t){return t};return function(t){var n=e(t),r=u(n);return void 0!==r._&&1==Object.keys(r).length?r._:r}}function traverse(t,n){for(var r in t)t[r]=n(t,r,t[r]);for(var e in t)"object"==_typeof2(t[e])&&traverse(t[e],n)}return{fn:parse,eval:parse,assign:fnassign,expr:exprfn,expression:exprfn,traverse:traverse}}module.exports=instance},{extend:6,mingo:7}],4:[function(t,n,r){var e=t("./expression"),u=(t("./mingo_ex"),e("$"));u.newInstance=function(t){return e(t)},n.exports=u},{"./expression":3,"./mingo_ex":5}],5:[function(t,n,r){var e=t("mingo"),u=t("./expression")("$"),i={},a={};e.addOperators(e.OP_QUERY,function(t){return{$starts:function(t,n,r){return r=Array.isArray(r)?r:[r],(n||"").startsWith(r[0])},$startsWith:function(t,n,r){return r=Array.isArray(r)?r:[r],(n||"").startsWith(r[0])},$ends:function(t,n,r){return r=Array.isArray(r)?r:[r],(n||"").endsWith(r[0])},$endsWith:function(t,n,r){return r=Array.isArray(r)?r:[r],(n||"").endsWith(r[0])},$contains:function(t,n,r){return r=Array.isArray(r)?r:[r],0<=(n||"").indexOf(r[0])}}}),e.addOperators(e.OP_EXPRESSION,function(o){return{$eval:function(t,n,r){return i[n]||(i[n]=u.eval(n)),i[n](t)},$expr:function(t,n,r){return a[n]||(a[n]=u.expr(n)),a[n](t)},$keyval:function(t,n,r){return o.computeValue(t,n).reduce(function(t,n){return t[n[0]]=n[1]||"_",t},{})},$trim:function(t,n,r){for(var e=new Set((n.chars||"").split("")),u=o.computeValue(t,n.input).split("");e.has(u[0]);)u.shift();for(;e.has(u[u.length-1]);)u.pop();return u.join("")},$starts:function(t,n,r){return(o.computeValue(t,n[0])||"").startsWith(n[1])},$startsWidth:function(t,n,r){return(o.computeValue(t,n[0])||"").startsWith(n[1])},$ends:function(t,n,r){return(o.computeValue(t,n[0])||"").endsWith(n[1])},$endsWith:function(t,n,r){return(o.computeValue(t,n[0])||"").endsWith(n[1])},$contains:function(t,n,r){return 0<=(o.computeValue(t,n[0])||"").indexOf(n[1])}}}),n.exports=e},{"./expression":3,mingo:7}],6:[function(t,n,r){var u=Object.prototype.hasOwnProperty,o=Object.prototype.toString,e=Object.defineProperty,i=Object.getOwnPropertyDescriptor,l=function(t){return"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===o.call(t)},v=function(t){if(!t||"[object Object]"!==o.call(t))return!1;var n,r=u.call(t,"constructor"),e=t.constructor&&t.constructor.prototype&&u.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!r&&!e)return!1;for(n in t);return void 0===n||u.call(t,n)},h=function(t,n){e&&"__proto__"===n.name?e(t,n.name,{enumerable:!0,configurable:!0,value:n.newValue,writable:!0}):t[n.name]=n.newValue},p=function(t,n){if("__proto__"===n){if(!u.call(t,n))return;if(i)return i(t,n).value}return t[n]};n.exports=function t(){var n,r,e,u,o,i,a=arguments[0],s=1,c=arguments.length,f=!1;for("boolean"==typeof a&&(f=a,a=arguments[1]||{},s=2),(null==a||"object"!==(void 0===a?"undefined":_typeof2(a))&&"function"!=typeof a)&&(a={});s<c;++s)if(null!=(n=arguments[s]))for(r in n)e=p(a,r),a!==(u=p(n,r))&&(f&&u&&(v(u)||(o=l(u)))?(i=o?(o=!1,e&&l(e)?e:[]):e&&v(e)?e:{},h(a,{name:r,newValue:t(f,i,u)})):void 0!==u&&h(a,{name:r,newValue:u}));return a}},{}],7:[function(t,n,r){var e,u;e=this,u=function(){function e(t){return(e="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(t){return void 0===t?"undefined":_typeof2(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":void 0===t?"undefined":_typeof2(t)})(t)}function i(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function u(t,n){for(var r=0;r<n.length;r++){var e=n[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function t(t,n,r){return n&&u(t.prototype,n),r&&u(t,r),t}function o(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],e=!0,u=!1,o=void 0;try{for(var i,a=t[Symbol.iterator]();!(e=(i=a.next()).done)&&(r.push(i.value),!n||r.length!==n);e=!0);}catch(t){u=!0,o=t}finally{try{e||null==a.return||a.return()}finally{if(u)throw o}}return r}(t,n)||function(t,n){if(!t)return;if("string"==typeof t)return a(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a(t,n)}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,e=new Array(n);r<n;r++)e[r]=t[r];return e}var s="null",c="undefined",f="boolean",l="number",v="string",h="date",p="regexp",d="array",y="object",g="function",m=[s,c,f,l,v,h,p],$="expression",_="group",b="pipeline",x="projection",k="query",O=function(){};Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(t,n){if(null==this)throw new TypeError('"this" is null or not defined');var r=Object(this),e=r.length>>>0;if(0===e)return!1;var u,o,i=0|n,a=Math.max(0<=i?i:e-Math.abs(i),0);for(;a<e;){if((u=r[a])===(o=t)||"number"==typeof u&&"number"==typeof o&&isNaN(u)&&isNaN(o))return!0;a++}return!1}});var w=Array.prototype.push;function j(t,n){t||J(n)}function A(t){switch(S(t)){case d:return t.map(A);case y:return K(t,A);default:return t}}function E(t){switch(S(t)){case d:return st([],t);case y:return Object.assign({},t);default:return t}}function M(t){return null===t?"Null":void 0===t?"Undefined":t.constructor.name}function S(t){return M(t).toLowerCase()}function N(t){return S(t)===f}function R(t){return S(t)===v}function P(t){return S(t)===l}var I=Array.isArray||function(t){return!!t&&t.constructor===Array};function C(t){return!!t&&t.constructor===Object}function L(t){return t===Object(t)}function T(t){return S(t)===h}function q(t){return S(t)===p}function r(t){return S(t)===g}function V(t){return null==t}function U(t){return null===t}function n(t){return void 0===t}function D(t,n){return t.includes(n)}function F(t,n){return!D(t,n)}function z(t){return!!t}function W(t){return V(t)||I(t)&&0===t.length||C(t)&&0===H(t).length||!t}function X(t){return I(t)?t:[t]}function B(t,n){return t.hasOwnProperty(n)}function J(t){throw new Error(t)}var H=Object.keys;function Y(t,n,r){if(n=n.bind(r),I(t))for(var e=0,u=t.length;e<u&&!1!==n(t[e],e,t);e++);else for(var o in t)if(t.hasOwnProperty(o)&&!1===n(t[o],o,t))break}function K(t,n,r){n=n.bind(r);for(var e={},u=H(t),o=0;o<u.length;o++){var i=u[o];e[i]=n(t[i],i)}return e}function Q(n,r){var e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(n===O)return r;if(r===O)return n;var t=[n,r];if(!t.every(C)&&!t.every(I))throw Error("mismatched types. must both be array or object");if(e.flatten=e.flatten||!1,I(n))if(e.flatten){for(var u=0,o=0;u<n.length&&o<r.length;)n[u]=Q(n[u++],r[o++],e);for(;o<r.length;)n.push(r[o++])}else w.apply(n,r);else Object.keys(r).forEach(function(t){n.hasOwnProperty(t)?n[t]=Q(n[t],r[t],e):n[t]=r[t]});return n}function Z(r,e,u){return I(r)?r.reduce(e,u):(Y(r,function(t,n){return u=e(u,t,n,r)}),u)}function G(t,n){var r=n.map(ut);return t.filter(function(t){return D(r,ut(t))})}function tt(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:-1,o=[];return function t(n,r){for(var e=0,u=n.length;e<u;e++)I(n[e])&&(0<r||r<0)?t(n[e],Math.max(-1,r-1)):o.push(n[e])}(t,n),o}function nt(t,n){for(var r=[t],e=[n];0<r.length;)if((t=r.pop())!==(n=e.pop())){var u=S(t);if(u!==S(n)||u===g)return!1;switch(u){case d:if(t.length!==n.length)return!1;st(r,t),st(e,n);break;case y:var o=H(t),i=H(n);if(o.length!==i.length)return!1;o.sort(),i.sort();for(var a=0,s=o.length;a<s;a++){var c=o[a];if(c!==i[a])return!1;r.push(t[c]),e.push(n[c])}break;default:if(et(t)!==et(n))return!1}}return 0===r.length}function rt(t){var r={},e=[];return Y(t,function(t){var n=ut(t);B(r,n)||(e.push(t),r[n]=0)}),e}function et(n){var t=S(n);switch(t){case f:case l:case p:return n.toString();case v:return JSON.stringify(n);case h:return n.toISOString();case s:case c:return t;case d:return"["+n.map(et)+"]";default:var r=t===y?"":"".concat(M(n)),e=H(n);return e.sort(),"".concat(r,"{")+e.map(function(t){return"".concat(et(t),":").concat(et(n[t]))})+"}"}}function ut(t){if(V(t))return null;for(var n=0,r=et(t),e=r.length;e;)n=(n<<5)-n^r.charCodeAt(--e);return n>>>0}function ot(t,n){return t<n?-1:n<t?1:0}function it(t,n,r){var e=[],u=[],o={};if(r=r||ot,W(t))return t;for(var i=0;i<t.length;i++){var a=t[i],s=n(a,i);V(s)?u.push(a):(o[s]?o[s].push(a):o[s]=[a],e.push(s))}e.sort(r);for(var c=0;c<e.length;c++)st(u,o[e[c]]);return u}function at(t,u){var o={keys:[],groups:[]},i={};return Y(t,function(t){var n=u(t),r=ut(n),e=-1;void 0===i[r]&&(e=o.keys.length,i[r]=e,o.keys.push(n),o.groups.push([])),e=i[r],o.groups[e].push(t)}),o}function st(t,n){return w.apply(t,n),t}function ct(t,n){return L(t)?t[n]:void 0}function ft(t,n){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=0;return r.meta=r.meta||!1,t=D(m,S(t))?t:function e(t,u){for(var n=t,r=0;r<u.length;r++){var o=u[r];if(null===o.match(/^\d+$/)&&I(n)){if(0===r&&0<i)break;i+=1,u=u.slice(r),n=Z(n,function(t,n){var r=e(n,u);return void 0!==r&&t.push(r),t},[]);break}if(void 0===(n=ct(n,o)))break}return n}(t,n.split(".")),r.meta?{result:t,depth:i}:t}function lt(t,n){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};r.preserveMissingValues=r.preserveMissingValues||!1;var e,u,o=n.split("."),i=o[0],a=1===o.length||o.slice(1).join("."),s=null!==i.match(/^\d+$/),c=1<o.length;try{I(t)?s?(e=ct(t,Number(i)),c&&(e=lt(e,a,r)),e=[e]):(e=[],Y(t,function(t){u=lt(t,n,r),r.preserveMissingValues?(void 0===u&&(u=O),e.push(u)):void 0!==u&&e.push(u)})):(u=ct(t,i),c&&(u=lt(u,a,r)),j(void 0!==u),(e={})[i]=u)}catch(t){e=void 0}return e}function vt(t){if(I(t))for(var n=t.length-1;0<=n;n--)t[n]===O?t.splice(n,1):vt(t[n]);else if(C(t))for(var r in t)t.hasOwnProperty(r)&&vt(t[r]);return t}function ht(t,n,r){var e=3<arguments.length&&void 0!==arguments[3]&&arguments[3],u=n.split("."),o=u[0],i=1===u.length||u.slice(1).join(".");1===u.length?r(t,o):(!0===e&&V(t[o])&&(t[o]={}),ht(t[o],i,r,e))}function pt(t,n,r){ht(t,n,function(t,n){t[n]=r},!0)}function dt(t,n){ht(t,n,function(t,n){I(t)&&/^\d+$/.test(n)?t.splice(parseInt(n),1):C(t)&&delete t[n]})}function yt(t){return!!t&&"$"===t[0]}function gt(t){if(D(m,S(t)))return q(t)?{$regex:t}:{$eq:t};if(L(t)){var n=H(t);if(!n.some(yt))return{$eq:t};if(D(n,"$regex")){var r=t.$regex,e=t.$options||"",u="";R(r)&&(u+=r.ignoreCase||0<=e.indexOf("i")?"i":"",u+=r.multiline||0<=e.indexOf("m")?"m":"",u+=r.global||0<=e.indexOf("g")?"g":"",r=new RegExp(r,u)),t.$regex=r,delete t.$options}}return t}function mt(t,n){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;return V(r)?n<0?(n=Math.max(0,t.length+n),r=t.length-n+1):(r=n,n=0):(n<0&&(n=Math.max(0,t.length+n)),j(0<r,"Invalid argument value for $slice operator. Limit must be a positive number"),r+=n),t.slice(n,r)}function $t(t,n){var r=Z(t,function(t,n){return t+n},0),e=t.length||1,u=n?1:0,o=r/e;return Math.sqrt(Z(t,function(t,n){return t+Math.pow(n-o,2)},0)/(e-u))}var _t=function(){return Object.assign({computeValue:Mt,ops:At},{assert:j,clone:E,cloneDeep:A,each:Y,err:J,hashCode:ut,getType:M,has:B,includes:D.bind(null),isArray:I,isBoolean:N,isDate:T,isEmpty:W,isEqual:nt,isFunction:r,isNil:V,isNull:U,isNumber:P,isObject:C,isRegExp:q,isString:R,isUndefined:n,keys:H,reduce:Z,resolve:ft,resolveObj:lt})},bt={key:"_id"};var xt={$$ROOT:function(t,n,r){return r.root},$$CURRENT:function(t,n,r){return t},$$REMOVE:function(t,n,r){}},kt={$$KEEP:function(t){return t},$$PRUNE:function(){},$$DESCEND:function(r,e,u){return B(e,"$cond")&&Y(r,function(t,n){L(t)&&(I(t)?(o=[],Y(t,function(t){C(t)&&(t=St(t,e,u)),V(t)||o.push(t)})):o=St(t,e,u),V(o)?delete r[n]:r[n]=o)}),r;var o}},Ot=H(xt),wt=H(kt);function jt(){return bt.key}function At(){return Z(Array.prototype.slice.call(arguments),function(t,n){return st(t,H(Gn[n]))},[])}function Et(r,t,e){if(B(Gn[_],t))return Gn[_][t](r,e);if(C(e)){var u={};return Y(e,function(t,n){if(u[n]=Et(r,n,e[n]),B(Gn[_],n))return u=u[n],j(1===H(e).length,"Invalid $group expression '"+JSON.stringify(e)+"'"),!1}),u}}function Mt(r,e){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,u=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if(u.root=u.root||r,B(Gn[$],t))return Gn[$][t](r,e,u);if(B(Gn[_],t))return r=Mt(r,e,null,u),j(I(r),t+" expression must resolve to an array"),Gn[_][t](r,null,u);if(R(e)&&0<e.length&&"$"===e[0]){if(D(Ot,e))return xt[e](r,null,u);if(D(wt,e))return e;var n=Ot.filter(function(t){return 0===e.indexOf(t+".")});return 1===n.length&&("$$ROOT"===(n=n[0])&&(r=u.root),e=e.substr(n.length)),ft(r,e.slice(1))}switch(S(e)){case d:return e.map(function(t){return Mt(r,t)});case y:var o={};return Y(e,function(t,n){if(o[n]=Mt(r,t,n,u),[$,_].some(function(t){return B(Gn[t],n)}))return j(1===H(e).length,"Invalid aggregation expression '"+JSON.stringify(e)+"'"),o=o[n],!1}),o;default:return e}}function St(t,n){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};r.root=r.root||t;var e=Mt(t,n,null,r);return D(wt,e)?kt[e](t,n,r):e}function Nt(t,n,r){n=n||0;var e=Math.abs(t)===t?1:-1;t=Math.abs(t);var u=Math.trunc(t),o=t-u;if(0===n){var i=Math.trunc(10*o);r&&1==(1&u)&&5<=i&&u++}else if(0<n){var a=Math.pow(10,n),s=Math.trunc(o*a),c=Math.trunc(o*a*10)%10;r&&5<c&&(s+=1),u+=s/a}else if(n<0){var f=Math.pow(10,-1*n),l=u%f;if(u=Math.max(0,u-l),r&&-1===e){for(;10<l;)l-=l%10;0<u&&5<=l&&(u+=f)}}return u*e}function Rt(t){return t instanceof Ut?t:new Ut(t)}function Pt(t){return!!t&&"object"===e(t)&&It(t.next)}function It(t){return!!t&&"function"==typeof t}Rt.isIterator=Pt;var Ct=new Error,Lt=1,Tt=2,qt=3,Vt=4;var Ut=function(){function o(t){if(i(this,o),this.__iteratees=[],this.__first=!1,this.__done=!1,this.__buf=[],It(t)&&(t={next:t}),Pt(t)){var n=t;t=function(){var t=n.next();if(t.done)throw Ct;return t.value}}else if(Array.isArray(t)){var r=t,e=r.length,u=0;t=function(){if(u<e)return r[u++];throw Ct}}else if(!It(t))throw new Error("Source is not iterable. Must be Array, Function or Object{next:Function}");var f,l,v,h,p,d;this.next=(f=t,l=this.__iteratees,v=this.__buf,h=!1,p=-1,d=0,function(t){t=t===v;try{t:for(;!h;){var n=f();p++;for(var r=-1,e=l.length,u=!1;++r<e;){var o=l[r],i=o.func;switch(o.type){case Lt:n=i(n,p);break;case Tt:if(!i(n,p))continue t;break;case qt:--o.func,o.func||(u=!0);break;case Vt:--o.func,o.func||(s=r,c=(a=l).slice(s+1),a.splice(s),Array.prototype.push.apply(a,c));continue t;default:break t}}if(h=u,!t)return{value:n,done:!1};v[d++]=n}}catch(t){if(t!==Ct)throw t}var a,s,c;return{done:h=!0}})}return t(o,[{key:"_validate",value:function(){if(this.__first)throw new Error("Cannot add iteratee/transform after `first()`")}},{key:"_push",value:function(t){return this._validate(),this.__iteratees.push(t),this}},{key:"map",value:function(t){return this._push({type:Lt,func:t})}},{key:"filter",value:function(t){return this._push({type:Tt,func:t})}},{key:"take",value:function(t){return 0<t?this._push({type:qt,func:t}):this}},{key:"drop",value:function(t){return 0<t?this._push({type:Vt,func:t}):this}},{key:"transform",value:function(t){this._validate();var n,r=this;return Rt(function(){return n||(n=Rt(t(r.value()))),n.next()})}},{key:"first",value:function(){return this.take(1),this.__first=!0,this}},{key:"value",value:function(){return this.__done||(this.__done=this.next(this.__buf).done),this.__first?this.__buf[0]:this.__buf}},{key:"each",value:function(t){for(;;){var n=this.next();if(n.done)break;if(!1===t(n.value))return!1}return!0}},{key:"reduce",value:function(t,n){var r=this.next(),e=0;for(void 0!==n||r.done||(n=r.value,r=this.next(),e++);!r.done;)n=t(n,r.value,e++),r=this.next();return n}},{key:"size",value:function(){return this.reduce(function(t,n){return++t},0)}}]),o}();"function"==typeof Symbol&&(Ut.prototype[Symbol.iterator]=function(){return this});var Dt=function(){function r(t,n){i(this,r),this.__operators=t,this.__options=n}return t(r,[{key:"stream",value:function(r,e){var u=this;r=Rt(r);var o=Gn[b];return W(this.__operators)||Y(this.__operators,function(t){var n=H(t);j(1===n.length&&D(At(b),n[0]),"invalid aggregation operator ".concat(n)),n=n[0],r=e&&e instanceof Wt?o[n].call(e,r,t[n],u.__options):o[n](r,t[n],u.__options)}),r}},{key:"run",value:function(t,n){return this.stream(t,n).value()}}]),r}();function Ft(t,n,r){return j(I(n),"Aggregation pipeline must be an array"),new Dt(n,r).run(t)}var zt=function(){function e(t,n,r){i(this,e),this.__filterFn=n.test.bind(n),this.__query=n,this.__source=t,this.__projection=r||n.__projection,this.__operators=[],this.__result=null,this.__stack=[],this.__options={}}return t(e,[{key:"_fetch",value:function(){return this.__result||(C(this.__projection)&&this.__operators.push({$project:this.__projection}),this.__result=Rt(this.__source).filter(this.__filterFn),0<this.__operators.length&&(this.__result=new Dt(this.__operators,this.__options).stream(this.__result,this.__query))),this.__result}},{key:"all",value:function(){return this._fetch().value()}},{key:"count",value:function(){return this.all().length}},{key:"skip",value:function(t){return this.__operators.push({$skip:t}),this}},{key:"limit",value:function(t){return this.__operators.push({$limit:t}),this}},{key:"sort",value:function(t){return this.__operators.push({$sort:t}),this}},{key:"collation",value:function(t){return this.__options.collation=t,this}},{key:"next",value:function(){if(this.__stack){if(0<this.__stack.length)return this.__stack.pop();var t=this._fetch().next();if(!t.done)return t.value;this.__stack=null}}},{key:"hasNext",value:function(){if(!this.__stack)return!1;if(0<this.__stack.length)return!0;var t=this._fetch().next();return t.done?this.__stack=null:this.__stack.push(t.value),!!this.__stack}},{key:"map",value:function(t){return this._fetch().map(t).value()}},{key:"forEach",value:function(t){this._fetch().each(t)}}]),e}();"function"==typeof Symbol&&(zt.prototype[Symbol.iterator]=function(){return this._fetch()});var Wt=function(){function r(t,n){i(this,r),this.__criteria=t,this.__projection=n||{},this.__compiled=[],this._compile()}return t(r,[{key:"_compile",value:function(){var n,e=this;j(C(this.__criteria),"query criteria must be an object"),Y(this.__criteria,function(t,r){"$where"===r?n={field:r,expr:t}:"$expr"===r?e._processOperator(r,r,t):D(["$and","$or","$nor"],r)?e._processOperator(r,r,t):(j(!yt(r),"unknown top level operator: ".concat(r)),Y(t=gt(t),function(t,n){e._processOperator(r,n,t)})),C(n)&&e._processOperator(n.field,n.field,n.expr)})}},{key:"_processOperator",value:function(t,n,r){j(B(Gn[k],n),"invalid query operator ".concat(n," detected")),this.__compiled.push(Gn[k][n](t,r))}},{key:"test",value:function(t){for(var n=0,r=this.__compiled.length;n<r;n++)if(!this.__compiled[n](t))return!1;return!0}},{key:"find",value:function(t,n){return new zt(t,this,n)}},{key:"remove",value:function(t){var r=this;return Z(t,function(t,n){return r.test(n)||t.push(n),t},[])}}]),r}();function Xt(t,n){if(nt(t,n))return!0;if(V(t)&&V(n))return!0;if(I(t)){var r=nt.bind(null,n);return t.some(r)||tt(t,1).some(r)}return!1}function Bt(t,n){return!Xt(t,n)}function Jt(t,n){return V(t)?n.some(U):0<G(X(t),n).length}function Ht(t,n){return!Jt(t,n)}function Yt(t,n){return tn(t,n,function(t,n){return t<n})}function Kt(t,n){return tn(t,n,function(t,n){return t<=n})}function Qt(t,n){return tn(t,n,function(t,n){return n<t})}function Zt(t,n){return tn(t,n,function(t,n){return n<=t})}function Gt(t,n){if(I(t)&&!W(t)){var r=function(t){return t},e=n;H(n).every(yt)&&(e={temp:n},r=function(t){return{temp:t}});for(var u=new Wt(e),o=0,i=t.length;o<i;o++)if(u.test(r(t[o])))return!0}return!1}function tn(t,n,r){return X(t).some(function(t){return M(t)===M(n)&&r(t,n)})}function nn(e){return function(t,n){var r=Mt(t,n);return e(r[0],r[1])}}var rn=nn(Xt),en=nn(Bt),un=nn(Qt),on=nn(Yt),an=nn(Zt),sn=nn(Kt),cn=nn(Ht);function fn(t,n){var r=Mt(t,n),e=new Date(r.getFullYear(),0,0),u=r-e;return Math.round(u/864e5)}function ln(t,n){return Mt(t,n).getDate()}function vn(t,n){return Mt(t,n).getDay()+1}function hn(t,n){return Mt(t,n).getFullYear()}function pn(t,n){return Mt(t,n).getMonth()+1}function dn(t,n){var r=Mt(t,n);(r=new Date(+r)).setHours(0,0,0),r.setDate(r.getDate()+4-(r.getDay()||7));var e=new Date(r.getFullYear(),0,1);return Math.floor(((r-e)/864e5+1)/7)}function yn(t,n){return Mt(t,n).getUTCHours()}function gn(t,n){return Mt(t,n).getMinutes()}function mn(t,n){return Mt(t,n).getSeconds()}function $n(t,n){return Mt(t,n).getMilliseconds()}var _n={"%Y":[hn,4],"%m":[pn,2],"%d":[ln,2],"%H":[yn,2],"%M":[gn,2],"%S":[mn,2],"%L":[$n,3],"%j":[fn,3],"%w":[vn,1],"%U":[dn,2],"%%":"%"};function bn(t,n){var r=Mt(t,n),e=r[0],u=r[1],o=r[2];return R(e)?u<0?"":o<0?e.substr(u):e.substr(u,o):""}var xn=[192,224,240];function kn(t){if(t<128)return[t];for(var n=(t<2048?1:t<65536&&2)||3,r=[(t>>6*n)+xn[n-1]];0<n;)r.push(128|t>>6*--n&63);return r}var On=Object.freeze({__proto__:null,$abs:function(t,n){var r=Mt(t,n);return null==r?null:Math.abs(r)},$add:function(t,n){var r=Mt(t,n),e=!1,u=Z(r,function(t,n){return T(n)&&(j(!e,"'$add' can only have one date value"),e=!0,n=n.getTime()),t+=n},0);return e?new Date(u):u},$ceil:function(t,n){var r=Mt(t,n);return V(r)?null:(j(P(r)||isNaN(r),"$ceil expression must resolve to a number."),Math.ceil(r))},$divide:function(t,n){var r=Mt(t,n);return r[0]/r[1]},$exp:function(t,n){var r=Mt(t,n);return V(r)?null:(j(P(r)||isNaN(r),"$exp expression must resolve to a number."),Math.exp(r))},$floor:function(t,n){var r=Mt(t,n);return V(r)?null:(j(P(r)||isNaN(r),"$floor expression must resolve to a number."),Math.floor(r))},$ln:function(t,n){var r=Mt(t,n);return V(r)?null:(j(P(r)||isNaN(r),"$ln expression must resolve to a number."),Math.log(r))},$log:function(t,n){var r=Mt(t,n),e="$log expression must resolve to array(2) of numbers";return j(I(r)&&2===r.length,e),r.some(V)?null:(j(r.some(isNaN)||r.every(P),e),Math.log10(r[0])/Math.log10(r[1]))},$log10:function(t,n){var r=Mt(t,n);return V(r)?null:(j(P(r)||isNaN(r),"$log10 expression must resolve to a number."),Math.log10(r))},$mod:function(t,n){var r=Mt(t,n);return r[0]%r[1]},$multiply:function(t,n){return Z(Mt(t,n),function(t,n){return t*n},1)},$pow:function(t,n){var r=Mt(t,n);return j(I(r)&&2===r.length&&r.every(P),"$pow expression must resolve to array(2) of numbers"),j(!(0===r[0]&&r[1]<0),"$pow cannot raise 0 to a negative exponent"),Math.pow(r[0],r[1])},$round:function(t,n){var r=Mt(t,n),e=r[0],u=r[1];return V(e)||isNaN(e)||Math.abs(e)===1/0?e:(j(P(e),"$round expression must resolve to a number."),Nt(e,u,!0))},$sqrt:function(t,n){var r=Mt(t,n);return V(r)?null:(j(P(r)&&0<r||isNaN(r),"$sqrt expression must resolve to non-negative number."),Math.sqrt(r))},$subtract:function(t,n){var r=Mt(t,n);return r[0]-r[1]},$trunc:function(t,n){var r=Mt(t,n),e=r[0],u=r[1];return V(e)||isNaN(e)||Math.abs(e)===1/0?e:(j(P(e),"$trunc expression must resolve to a number."),j(V(u)||P(u)&&-20<u&&u<100,"$trunc expression has invalid place"),Nt(e,u,!1))},$arrayElemAt:function(t,n){var r=Mt(t,n);j(I(r)&&2===r.length,"$arrayElemAt expression must resolve to array(2)"),j(I(r[0]),"First operand to $arrayElemAt must resolve to an array"),j(P(r[1]),"Second operand to $arrayElemAt must resolve to an integer");var e=r[1];return r=r[0],e<0&&Math.abs(e)<=r.length?r[e+r.length]:0<=e&&e<r.length?r[e]:void 0},$arrayToObject:function(t,n){var r=Mt(t,n);return j(I(r),"$arrayToObject expression must resolve to an array"),Z(r,function(t,n){return I(n)&&2==n.length?t[n[0]]=n[1]:(j(C(n)&&B(n,"k")&&B(n,"v"),"$arrayToObject expression is invalid."),t[n.k]=n.v),t},{})},$concatArrays:function(t,n){var r=Mt(t,n,null);return j(I(r),"$concatArrays must resolve to an array"),r.some(V)?null:r.reduce(function(t,n){return st(t,n)},[])},$filter:function(t,n){var r=Mt(t,n.input),e=n.as,u=n.cond;return j(I(r),"$filter 'input' expression must resolve to an array"),r.filter(function(t){var n={};return n["$"+e]=t,!0===Mt(n,u)})},$in:function(t,n){var r=Mt(t,n[0]),e=Mt(t,n[1]);return j(I(e),"$in second argument must be an array"),e.some(nt.bind(null,r))},$indexOfArray:function(t,n){var r=Mt(t,n);if(V(r))return null;var e=r[0],u=r[1];if(V(e))return null;j(I(e),"$indexOfArray expression must resolve to an array.");var o=r[2]||0,i=r[3];return V(i)&&(i=e.length),i<o?-1:(j(0<=o&&0<=i,"$indexOfArray expression is invalid"),(0<o||i<e.length)&&(e=e.slice(o,i)),e.findIndex(nt.bind(null,u))+o)},$isArray:function(t,n){return I(Mt(t,n[0]))},$map:function(n,t){var r=Mt(n,t.input);j(I(r),"$map 'input' expression must resolve to an array");var e=t.as,u=t.in,o="$"+e;return r.map(function(t){return n[o]=t,Mt(n,u)})},$objectToArray:function(t,n){var r=Mt(t,n);j(C(r),"$objectToArray expression must resolve to an object");var e=[];return Y(r,function(t,n){return e.push({k:n,v:t})}),e},$range:function(t,n){for(var r=Mt(t,n),e=r[0],u=r[1],o=r[2]||1,i=[];e<u&&0<o||u<e&&o<0;)i.push(e),e+=o;return i},$reduce:function(t,n){var r=Mt(t,n.input),e=Mt(t,n.initialValue),u=n.in;return V(r)?null:(j(I(r),"$reduce 'input' expression must resolve to an array"),Z(r,function(t,n){return Mt({$value:t,$this:n},u)},e))},$reverseArray:function(t,n){var r=Mt(t,n);if(V(r))return null;j(I(r),"$reverseArray expression must resolve to an array");var e=[];return st(e,r),e.reverse(),e},$size:function(t,n){var r=Mt(t,n);return I(r)?r.length:void 0},$slice:function(t,n){var r=Mt(t,n);return mt(r[0],r[1],r[2])},$zip:function(t,n){var e=Mt(t,n.inputs),r=n.useLongestLength||!1;j(I(e),"'inputs' expression must resolve to an array"),j(N(r),"'useLongestLength' must be a boolean"),I(n.defaults)&&j(z(r),"'useLongestLength' must be set to true to use 'defaults'");for(var u=0,o=0,i=e.length;o<i;o++){var a=e[o];if(V(a))return null;j(I(a),"'inputs' expression values must resolve to an array or null"),u=r?Math.max(u,a.length):Math.min(u||a.length,a.length)}for(var s=[],c=n.defaults||[],f=function(r){var t=e.map(function(t,n){return V(t[r])?c[n]||null:t[r]});s.push(t)},l=0;l<u;l++)f(l);return s},$mergeObjects:function(t,n){var r=Mt(t,n);return I(r)?Z(r,function(t,n){return Object.assign(t,n)},{}):{}},$and:function(t,n){var r=Mt(t,n);return z(r)&&r.every(z)},$or:function(t,n){var r=Mt(t,n);return z(r)&&r.some(z)},$not:function(t,n){return!Mt(t,n[0])},$eq:rn,$ne:en,$gt:un,$lt:on,$gte:an,$lte:sn,$nin:cn,$cmp:function(t,n){var r=Mt(t,n);return r[0]>r[1]?1:r[0]<r[1]?-1:0},$cond:function(t,n){var r,e,u,o="$cond: invalid arguments";return u=I(n)?(j(3===n.length,o),r=n[0],e=n[1],n[2]):(j(C(n),o),r=n.if,e=n.then,n.else),Mt(t,Mt(t,r)?e:u)},$switch:function(n,t){var r="Invalid arguments for $switch operator";j(t.branches,r);var e=t.branches.find(function(t){return j(t.case&&t.then,r),Mt(n,t.case)});return e?Mt(n,e.then):(j(t.default,r),Mt(n,t.default))},$ifNull:function(t,n){j(I(n)&&2===n.length,"$ifNull expression must resolve to array(2)");var r=Mt(t,n);return V(r[0])?r[1]:r[0]},$dayOfYear:fn,$dayOfMonth:ln,$dayOfWeek:vn,$year:hn,$month:pn,$week:dn,$hour:yn,$minute:gn,$second:mn,$millisecond:$n,$dateToString:function(t,n){for(var r,e,u=n.format,o=Mt(t,n.date),i=u.match(/(%%|%Y|%m|%d|%H|%M|%S|%L|%j|%w|%U)/g),a=0,s=i.length;a<s;a++){var c=_n[i[a]],f=c;if(I(c)){var l=c[0],v=c[1];r=l(t,o),e=v,f=new Array(Math.max(e-String(r).length+1,0)).join("0")+r}u=u.replace(i[a],f)}return u},$literal:function(t,n){return n},$setEquals:function(t,n){var r=Mt(t,n),e=rt(r[0]),u=rt(r[1]);return e.length===u.length&&e.length===G(e,u).length},$setIntersection:function(t,n){var r=Mt(t,n);return G(r[0],r[1])},$setDifference:function(t,n){var r=Mt(t,n);return r[0].filter(F.bind(null,r[1]))},$setUnion:function(t,n){var r,e,u=Mt(t,n);return r=u[0],e=u[1],st(st([],r),e.filter(F.bind(null,r)))},$setIsSubset:function(t,n){var r=Mt(t,n);return G(r[0],r[1]).length===r[0].length},$anyElementTrue:function(t,n){return Mt(t,n)[0].some(z)},$allElementsTrue:function(t,n){return Mt(t,n)[0].every(z)},$concat:function(t,n){var r=Mt(t,n);return[null,void 0].some(D.bind(null,r))?null:r.join("")},$indexOfBytes:function(t,n){var r=Mt(t,n),e="$indexOfBytes expression resolves to invalid an argument";if(V(r[0]))return null;j(R(r[0])&&R(r[1]),e);var u=r[0],o=r[1],i=r[2],a=r[3],s=V(i)||P(i)&&0<=i&&Math.round(i)===i;if(j(s=s&&(V(a)||P(a)&&0<=a&&Math.round(a)===a),e),i=i||0,(a=a||u.length)<i)return-1;var c=u.substring(i,a).indexOf(o);return-1<c?c+i:c},$split:function(t,n){var r=Mt(t,n);return V(r[0])?null:(j(r.every(R),"$split expression must result to array(2) of strings"),r[0].split(r[1]))},$strLenBytes:function(t,n){return~-encodeURI(Mt(t,n)).split(/%..|./).length},$strLenCP:function(t,n){return Mt(t,n).length},$strcasecmp:function(t,n){var r=Mt(t,n),e=r[0],u=r[1];return nt(e,u)||r.every(V)?0:(j(r.every(R),"$strcasecmp must resolve to array(2) of strings"),e=e.toUpperCase(),((u=u.toUpperCase())<e?1:e<u&&-1)||0)},$substrBytes:function(t,n){var r=Mt(t,n),e=r[0],u=r[1],o=r[2];j(R(e)&&P(u)&&0<=u&&P(o)&&0<=o,"$substrBytes: invalid arguments");for(var i=function(t){for(var n=[],r=0,e=t.length;r<e;r++)n.push(kn(t.codePointAt(r)));return n}(e),a=[],s=0,c=0;c<i.length;c++)a.push(s),s+=i[c].length;var f=a.indexOf(u),l=a.indexOf(u+o);return j(-1<f&&-1<l,"$substrBytes: invalid range, start or end index is a UTF-8 continuation byte."),e.substring(f,l)},$substr:bn,$substrCP:function(t,n){return bn(t,n)},$toLower:function(t,n){var r=Mt(t,n);return W(r)?"":r.toLowerCase()},$toUpper:function(t,n){var r=Mt(t,n);return W(r)?"":r.toUpperCase()},$let:function(r,t){var e=t.vars,n=t.in;return Y(H(e),function(t){var n=Mt(r,e[t]);r["$"+t]=n}),Mt(r,n)}});function wn(t,n){return V(n)?t:t.map(function(t){return Mt(t,n)})}var jn=Object.freeze({__proto__:null,$addToSet:function(t,n){return rt(wn(t,n))},$avg:function(t,n){var r=wn(t,n).filter(P);return Z(r,function(t,n){return t+n},0)/(r.length||1)},$first:function(t,n){return 0<t.length?Mt(t[0],n):void 0},$last:function(t,n){return 0<t.length?Mt(t[t.length-1],n):void 0},$max:function(t,n){return Z(wn(t,n),function(t,n){return V(t)||t<n?n:t},void 0)},$mergeObjects:function(t,r){return Z(t,function(t,n){return Object.assign(t,Mt(n,r))},{})},$min:function(t,n){return Z(wn(t,n),function(t,n){return V(t)||n<t?n:t},void 0)},$push:wn,$stdDevPop:function(t,n){return $t(wn(t,n).filter(P),!1)},$stdDevSamp:function(t,n){return $t(wn(t,n).filter(P),!0)},$sum:function(t,n){return I(t)?P(n)?t.length*n:Z(wn(t,n).filter(P),function(t,n){return t+n},0):0}});function An(t,u,n){var o=H(u);return 0===o.length?t:t.map(function(r){var e=A(r);return Y(o,function(t){var n=Mt(r,u[t]);pt(e,t,n)}),e})}var En=An;function Mn(t,o,n){var i=jt(),r=o[i];return t.transform(function(t){var e=at(t,function(t){return Mt(t,r,r)});delete(o=E(o))[i];var u=-1,n=e.keys.length;return function(){if(++u===n)return{done:!0};var t=e.keys[u],r={};return void 0!==t&&(r[i]=t),Y(o,function(t,n){r[n]=Et(e.groups[u],n,t)}),{value:r,done:!1}}})}function Sn(t){var r=jt(),e=[!1,!1];Y(t,function(t,n){n!==r&&(0===t||!1===t?e[0]=!0:1!==t&&!0!==t||(e[1]=!0),j(!(e[0]&&e[1]),"Projection cannot have a mix of inclusion and exclusion."))})}function Nn(t,o,n){if(W(o)||!C(o))return t;var i=ot,r=(n=n||{}).collation;return C(r)&&R(r.locale)&&(i=function(t){var n={sensitivity:Rn[t.strength||3],caseFirst:"off"===t.caseFirst?"false":t.caseFirst||"false",numeric:t.numericOrdering||!1,ignorePunctuation:"shifted"===t.alternate};!0===(t.caseLevel||!1)&&("base"===n.sensitivity&&(n.sensitivity="case"),"accent"===n.sensitivity&&(n.sensitivity="variant"));var e=new Intl.Collator(t.locale,n);return function(t,n){if(!R(t)||!R(n))return ot(t,n);var r=e.compare(t,n);return r<0?-1:0<r?1:0}}(r)),t.transform(function(u){return Y(H(o).reverse(),function(n){var r=at(u,function(t){return ft(t,n)}),e={},t=it(r.keys,function(t,n){return e[t]=n,t},i);-1===o[n]&&t.reverse(),u=[],Y(t,function(t){return st(u,r.groups[e[t]])})}),u})}var Rn={1:"base",2:"accent",3:"variant"};var Pn=Object.freeze({__proto__:null,$addFields:An,$set:En,$bucket:function(t,u,n){var o=u.boundaries,i=u.default,a=o[0],s=o[o.length-1],r=u.output||{count:{$sum:1}};j(2<o.length,"$bucket 'boundaries' expression must have at least 3 elements");for(var e=M(a),c=0,f=o.length-1;c<f;c++)j(e===M(o[c+1]),"$bucket 'boundaries' must all be of the same type"),j(o[c]<o[c+1],"$bucket 'boundaries' must be sorted in ascending order");!V(i)&&M(u.default)===M(a)&&j(a>u.default||s<u.default,"$bucket 'default' expression must be out of boundaries range");var l={};Y(o,function(t){return l[t]=[]}),V(i)||(l[i]=[]);var v=!1;return Rt(function(){return v||(t.each(function(t){var n=Mt(t,u.groupBy);if(V(n)||n<a||s<=n)j(!V(i),"$bucket require a default for out of range values"),l[i].push(t);else{j(a<=n&&n<s,"$bucket 'groupBy' expression must resolve to a value in range of boundaries");var r=function(t,n){for(var r=0,e=t.length-1;r<=e;){var u=Math.round(r+(e-r)/2);if(n<t[u])e=u-1;else{if(!(n>t[u]))return u;r=u+1}}return r}(o,n),e=o[Math.max(0,r-1)];l[e].push(t)}}),o.pop(),V(i)||o.push(i),v=Rt(o).map(function(t){var n=Et(l[t],null,r);return Object.assign(n,{_id:t})})),v.next()})},$bucketAuto:function(t,n,r){var d=n.output||{count:{$sum:1}},y=n.groupBy,g=n.buckets;return j(0<g,"The $bucketAuto 'buckets' field must be greater than 0, but found: "+g),t.transform(function(t){for(var n=Math.max(1,Math.round(t.length/g)),r=function(u){var o,i=this;return o={},function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var e=ut(n);return B(o,e)||(o[e]=u.apply(i,n)),o[e]}}(Mt),e={},u=[],o=it(t,function(t){var n=r(t,y);return V(n)?u.push(t):(e[n]||(e[n]=[]),e[n].push(t)),n}),i=jt(),a=[],s=0,c=0,f=o.length;c<g&&s<f;c++){for(var l={},v=[],h=0;h<n&&s<f;h++){var p=r(o[s],y);V(p)&&(p=null),st(v,V(p)?u:e[p]),s+=V(p)?u.length:e[p].length,B(l,"min")||(l.min=p),0<a.length&&(a[a.length-1][i].max=l.min)}c==g-1&&st(v,o.slice(s)),a.push(Object.assign(Et(v,null,d),{_id:l}))}return 0<a.length&&(a[a.length-1][i].max=r(o[o.length-1],y)),a})},$count:function(n,r,t){return j(R(r)&&""!==r.trim()&&-1===r.indexOf(".")&&"$"!==r.trim()[0],"Invalid expression value for $count"),Rt(function(){var t={};return t[r]=n.size(),{value:t,done:!1}}).first()},$facet:function(t,r,n){return t.transform(function(n){return[K(r,function(t){return Ft(n,t)})]})},$group:Mn,$limit:function(t,n,r){return t.take(n)},$lookup:function(t,n,r){var e=n.from,u=n.localField,o=n.foreignField,i=n.as;j(I(e)&&R(o)&&R(u)&&R(i),"$lookup: invalid argument");var a={};return Y(e,function(t){var n=ut(ft(t,o));a[n]=a[n]||[],a[n].push(t)}),t.map(function(t){var n=ut(ft(t,u)),r=E(t);return r[i]=a[n]||[],r})},$match:function(t,n,r){var e=new Wt(n);return t.filter(function(t){return e.test(t)})},$out:function(t,n,r){return j(I(n),"$out expression must be an array"),t.map(function(t){return n.push(t),t})},$project:function(t,n,r){if(W(n))return t;var e=H(n),u=!1,o=jt();if(Sn(n),D(e,o)){var i=n[o];0!==i&&!1!==i||(j(F(e=e.filter(F.bind(null,[o])),o),"Must not contain collections id key"),u=W(e))}else e.push(o);return t.map(function(t){return function s(c,f,t,n){var l=jt(),v={},h=!1,p=!1,d=[];return n&&d.push(l),t.forEach(function(t){var n,r=f[t];if(t!==l&&D([0,!1],r)&&(p=!0),t===l&&W(r))n=c[t];else if(R(r))n=Mt(c,r,t);else if(D([1,!0],r));else if(I(r))n=r.map(function(t){var n=Mt(c,t);return V(n)?null:n});else{if(!C(r))return void d.push(t);var e=H(r),u=!(1<e.length)&&e[0];if(D(At(x),u)){var o=Gn[x];"$slice"===u?X(r[u]).every(P)?(n=o[u](c,r[u],t),h=!0):n=Mt(c,r,t):n=o[u](c,r[u],t)}else if(B(c,t)){Sn(r);var i=c[t];n=I(i)?i.map(function(t){return s(t,r,e,!1)}):s(i,r,e,!1)}else n=Mt(c,r,t)}var a=lt(c,t,{preserveMissingValues:!0});void 0!==a&&Q(v,a,{flatten:!0}),F([0,1,!1,!0],r)&&(void 0===n?dt(v,t):pt(v,t,n))}),vt(v),(h||p||n)&&(v=Object.assign({},c,v),0<d.length&&(v=A(v),Y(d,function(t){return dt(v,t)}))),v}(t,n,e,u)})},$redact:function(t,n,r){return t.map(function(t){return St(A(t),n)})},$replaceRoot:function(t,n,r){return t.map(function(t){return j(C(t=Mt(t,n.newRoot)),"$replaceRoot expression must return an object"),t})},$sample:function(t,n,r){var u=n.size;return j(P(u),"$sample size must be a positive integer"),t.transform(function(n){var r=n.length,e=-1;return function(){if(++e===u)return{done:!0};var t=Math.floor(Math.random()*r);return{value:n[t],done:!1}}})},$skip:function(t,n,r){return t.drop(n)},$sort:Nn,$sortByCount:function(t,n,r){var e={count:{$sum:1}};return e[jt()]=n,Nn(Mn(t,e),{count:-1},r)},$unwind:function(u,t,n){R(t)&&(t={path:t});var o,i=t.path.substr(1),r=t.includeArrayIndex||!1,a=t.preserveNullAndEmptyArrays||!1,s=function(t,n){return!1!==r&&(t[r]=n),t};return Rt(function(){for(var t=function(){if(Rt.isIterator(o)){var t=o.next();if(!t.done)return{v:t}}var e=u.next();if(e.done)return{v:e};if(e=e.value,o=ft(e,i),I(o)){if(0===o.length&&!0===a){o=null;var n=A(e);return dt(n,i),{v:{value:s(n,null),done:!1}}}o=Rt(o).map(function(t,n){var r=A(e);return pt(r,i,t),s(r,n)})}else if(!W(o)||!0===a){var r=A(e);return{v:{value:s(r,null),done:!1}}}};;){var n=t();if("object"===e(n))return n.v}})}});var In=Object.freeze({__proto__:null,$:function(t,n,r){J("$ not implemented")},$elemMatch:function(t,n,r){var e=ft(t,r),u=new Wt(n);j(I(e),"$elemMatch: invalid argument");for(var o=0;o<e.length;o++)if(u.test(e[o]))return[e[o]]},$slice:function(t,n,r){var e=ft(t,r);return I(e)?I(n)?mt(e,n[0],n[1]):(j(P(n),"$slice: invalid arguments for projection"),mt(e,n)):e}});function Cn(u){return function(r,e){return function(t){var n=ft(t,r,{meta:!0});return n=function(t,n){if(n<1)return t;for(;n--&&I(t)&&1===t.length;)t=t[0];return t}(n.result,n.depth),u(n,e)}}}var Ln=Cn(function(t,n){var r=!1;if(I(t)&&I(n))for(var e=0,u=n.length;e<u;e++){if(!C(n[e])||!D(H(n[e]),"$elemMatch"))return G(n,t).length===u;r=r||Gt(t,n[e].$elemMatch)}return r}),Tn=Cn(Gt),qn=Cn(Xt),Vn=Cn(function(t,n){return(!1===n||0===n)&&void 0===t||(!0===n||1===n)&&void 0!==t}),Un=Cn(Qt),Dn=Cn(Zt),Fn=Cn(Jt),zn=Cn(Yt),Wn=Cn(Kt),Xn=Cn(function(t,n){return X(t).some(function(t){return P(t)&&I(n)&&2===n.length&&t%n[0]===n[1]})}),Bn=Cn(Bt),Jn=Cn(Ht),Hn=Cn(function(t,n){var r=function(t){return R(t)&&!!t.match(n)};return(t=X(t)).some(r)||tt(t,1).some(r)}),Yn=Cn(function(t,n){return I(t)&&P(n)&&t.length===n}),Kn=Cn(function(t,n){switch(n){case 1:case"double":return P(t)&&-1!==(t+"").indexOf(".");case 2:case v:return R(t);case 3:case y:return C(t);case 4:case d:return I(t);case 6:case c:return V(t);case 8:case"bool":return N(t);case 9:case h:return T(t);case 10:case s:return U(t);case 11:case"regex":return q(t);case 16:case"int":return P(t)&&t<=2147483647&&-1===(t+"").indexOf(".");case 18:case"long":return P(t)&&2147483647<t&&t<=0x8000000000000000&&-1===(t+"").indexOf(".");case 19:case"decimal":return P(t);default:return!1}});function Qn(t,n){j(I(n),"Invalid expression. $or expects value to be an Array");var r=[];return Y(n,function(t){return r.push(new Wt(t))}),function(t){for(var n=0;n<r.length;n++)if(r[n].test(t))return!0;return!1}}var Zn=Object.freeze({__proto__:null,$all:Ln,$elemMatch:Tn,$eq:qn,$exists:Vn,$gt:Un,$gte:Dn,$in:Fn,$lt:zn,$lte:Wn,$mod:Xn,$ne:Bn,$nin:Jn,$regex:Hn,$size:Yn,$type:Kn,$and:function(t,n){j(I(n),"Invalid expression: $and expects value to be an Array");var r=[];return Y(n,function(t){return r.push(new Wt(t))}),function(t){for(var n=0;n<r.length;n++)if(!r[n].test(t))return!1;return!0}},$or:Qn,$nor:function(t,n){j(I(n),"Invalid expression. $nor expects value to be an Array");var r=Qn(0,n);return function(t){return!r(t)}},$not:function(t,n){var r={};r[t]=gt(n);var e=new Wt(r);return function(t){return!e.test(t)}},$where:function(t,n){return r(n)||(n=new Function("return "+n+";")),function(t){return!0===n.call(t)}},$expr:function(t,n){return function(t){return Mt(t,n)}}}),Gn={};Gn[$]={},Gn[_]={},Gn[b]={},Gn[x]={},Gn[k]={};var tr={query:function(t,n){return new Wt(t).find(this.toJSON(),n)},aggregate:function(t){return new Dt(t).run(this.toJSON())}};Y([[$,On],[_,jn],[b,Pn],[x,In],[k,Zn]],function(t){var n=o(t,2),r=n[0],e=n[1];Object.assign(Gn[r],e)});return{_internal:_t,Aggregator:Dt,CollectionMixin:tr,Cursor:zt,Lazy:Rt,OP_EXPRESSION:$,OP_GROUP:_,OP_PIPELINE:b,OP_PROJECTION:x,OP_QUERY:k,Query:Wt,VERSION:"2.5.3",addOperators:function(r,t){var a=t(_t());j(B(Gn,r),"Invalid operator class ".concat(r));var e=Gn[r];Y(a,function(t,n){j(/^\$[a-zA-Z0-9_]*$/.test(n),"Invalid operator name ".concat(n)),j(!B(e,n),"".concat(n," already exists for '").concat(r,"' operators"))});var n={};switch(r){case k:Y(a,function(o,i){o=o.bind(a),n[i]=function(e,u){return function(t){var n=ft(t,e),r=o(e,n,u);return j(N(r),"".concat(i," must return a boolean")),r}}});break;case x:Y(a,function(u,t){u=u.bind(a),n[t]=function(t,n,r){var e=ft(t,r);return u(r,e,n)}});break;default:Y(a,function(e,t){n[t]=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(a,n)}})}Object.assign(Gn[r],n)},aggregate:Ft,find:function(t,n,r){return new Wt(n).find(t,r)},remove:function(t,n){return new Wt(n).remove(t)},setup:function(t){Object.assign(bt,t||{})}}},"object"===(void 0===r?"undefined":_typeof2(r))&&void 0!==n?n.exports=u():"function"==typeof define&&define.amd?define(u):(e=e||self).mingo=u()},{}]},{},[1]);