{"version":3,"sources":["jsexpr.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","module","root","previous_jsexpr","jsexpr","window","expr","extend","instance","token","RX","RegExp","RX_RPL_PARSE","RX_RPL_TOKEN","RX_JSON_TOKEN","CACHE","cacheeval","obj","key","rkey","replace","rx","fn","eval","test","fneval","err","undefined","fnassign","path","EVALS","v","iteval","arr","split","forEach","ceval","valwalk","src","ops","k","newpath","rop","parse","method","m","match","trim","Function","entry","tokens","parts","nexpr","spaces","isNaN","parseInt","fnxpr","JSON","stringify","list","len","idx","indexOf","substring","rtoken","push","filter","l","ret","jsontokens","json","walk","Object","keys","map","op","exprfn","input","assign","expression","newInstance","hasOwn","prototype","hasOwnProperty","toStr","toString","defineProperty","gOPD","getOwnPropertyDescriptor","isArray","Array","isPlainObject","hasOwnConstructor","hasIsPrototypeOf","constructor","setProperty","target","options","name","enumerable","configurable","value","newValue","writable","getProperty","copy","copyIsArray","clone","arguments","deep"],"mappings":"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","file":"jsexpr.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n\"use strict\";\n\n(function() {\n  var root = this\n  var previous_jsexpr = root.jsexpr;\n\tvar jsexpr = require('./index.js');\n\n\tif( typeof exports !== 'undefined' ) {\n    if( typeof module !== 'undefined' && module.exports ) {\n      exports = module.exports = jsexpr;\n    }\n    exports.jsexpr = jsexpr;\n  }\n\n\tif(typeof window !== 'undefined') {\n    window.jsexpr = jsexpr;\n  }\n\n}).call(this);\n\n},{\"./index.js\":2}],2:[function(require,module,exports){\n/*jshint esversion: 6 */\n\nconst expr = require('./lib');\n\nmodule.exports = expr;\n\n},{\"./lib\":4}],3:[function(require,module,exports){\nconst extend = require(\"extend\");\n\nfunction instance(token) {\n\tconst RX = new RegExp(`\\\\${token}\\\\{[^\\\\}]+\\\\}`,'g');\t\t\t\t\t// /\\$\\{[^\\}]+\\}/g;\n\tconst RX_RPL_PARSE = new RegExp(`\\\\${token}\\\\{([^\\\\}]+)\\\\}`);\t// /\\$\\{([^\\}]+)\\}/;\n\tconst RX_RPL_TOKEN = new RegExp(`\\\\${token}\\\\{|\\\\}`,'g');\t\t\t\t\t// /\\$\\{|\\}/g;\n\tconst RX_JSON_TOKEN = new RegExp(`^\\\\${token}\\\\{JSON(:(\\\\d+|([^:]+(:(\\\\d+))?)))?\\\\}$`);\n\tconst CACHE = {}\n\n\tfunction cacheeval(obj,key) {\n\t\tif(!CACHE[key]) {\n\t\t\tlet rkey = key.replace(/'/g,\"\\\\'\");\n\t\t\tlet rx = /^[a-zA-Z$_@]/;\n\t\t\tlet fn = eval(`(function(){\n\t\t\t\tlet rx = /^[a-zA-Z$_]/;\n\t\t\t\treturn '${rkey}'.startsWith('this.') || '${rkey}'=='this' || !rx.test('${rkey}')?\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tlet r = undefined;\n\t\t\t\t\t\ttry {r=${key};}\n\t\t\t\t\t\tcatch(err){}\n\t\t\t\t\t\treturn r;\n\t\t\t\t\t} :\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tlet r = undefined;\n\t\t\t\t\t\ttry {r=this.${rx.test(key)? key:'$___$'};}\n\t\t\t\t\t\tcatch(err){try{r=${key};}catch(err){}}\n\t\t\t\t\t\treturn r;\n\t\t\t\t\t}\n\t\t\t})()`);\n\t\t\tCACHE[key] = fn;\n\t\t}\n\t\treturn CACHE[key].call(obj);\n\t}\n\n\tfunction fneval(obj, key) {\n\t\ttry {\n\t\t\treturn eval(\"this.\" + key);\n\t\t} catch (err) {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tfunction fnassign(path) {\n\t\treturn eval(`(function(){\n\t\t\treturn function(obj,val) {\n\t\t\t\ttry {\n\t\t\t\t\treturn obj.${path} = val;\n\t\t\t\t}catch(err) {}\n\t\t\t}\n\t\t})()`);\n\t}\n\n\tconst EVALS = {\n\t\teval(obj,key) {\n\t\t\tlet v = fneval.call(obj,obj,key);\n\t\t\treturn v===undefined? \"\" : v;\n\t\t},\n\t\titeval(obj,key) {\n\t\t\tvar arr = key.split(\".\");\n\t\t\tarr.forEach(key=>{\n\t\t\t\tif(obj==null || obj==undefined) return;\n\t\t\t\telse obj = obj[key];\n\t\t\t});\n\n\t\t\tlet v = obj || undefined;\n\t\t\treturn v===undefined? \"\" : v;\n\t\t},\n\t\tceval(obj,key) {\n\t\t\tlet v = cacheeval(obj,key);\n\t\t\treturn v===undefined? \"\" : v;\n\t\t},\n\t\tvalwalk(src,ops,path) {\n\t\t\tif(!src) return src;\n\t\t\tfor(let k in src) {\n\t\t\t\tlet newpath = `${path}${path?'.':''}${k}`;\n\t\t\t\tlet rop = ops[newpath];\n\t\t\t\tif(rop!==undefined)\n\t\t\t\t\tsrc[k] = rop;\n\t\t\t\telse if(typeof(src[k])==\"object\")\n\t\t\t\t\tEVALS.valwalk(src[k],ops,newpath);\n\t\t\t};\n\t\t\treturn src;\n\t\t}\n\t}\n\n\tfunction parse(expr,method) {\n\t\tmethod = method || \"ceval\";\n\t\tvar m = expr.match(RX);\n\t\tif(m) {\n\t\t\tm.forEach(token=>{\n\t\t\t\tvar key = token.replace(RX_RPL_PARSE,\"$1\").trim().replace(/'/g,\"\\\\'\");\n\t\t\t\texpr = expr.replace(token,\"__val(entry,'\"+key+\"')\");\n\t\t\t});\n\t\t}\n\t\tvar fn = new Function(\"entry\",\"__val\",\"return (\"+expr+\")\");\n\n\t\treturn function(entry) {\n\t\t\treturn fn(entry,EVALS[method]);\n\t\t}\n\t}\n\n\tfunction tokens(expr,method) {\n\t\tmethod = EVALS[method || \"ceval\"];\n\n\t\t// JSON stringify\n\t\tif(RX_JSON_TOKEN.test(expr)) {\n\t\t\tlet parts = expr.replace(RX_RPL_TOKEN,\"\").split(\":\");\n\t\t\tlet nexpr = parts[1];\n\t\t\tlet spaces = parts[2];\n\t\t\tif(parts.length==2) {\n\t\t\t\tif(isNaN(nexpr)) {spaces = 2;}\n\t\t\t\telse {nexpr = 'this';\tspaces = parts[1];}\n\t\t\t}\n\t\t\telse if(parts.length==1) {\n\t\t\t\tnexpr = 'this';\n\t\t\t\tspaces = 2;\n\t\t\t}\n\t\t\tspaces = parseInt(spaces);\n\t\t\tlet fnxpr = tokens(\"${\"+nexpr+\"}\");\n\t\t\treturn function(entry) {\n\t\t\t\treturn JSON.stringify(fnxpr(entry),null,spaces);\n\t\t\t}\n\t\t}\n\n\t\tvar list = [], len = 0;\n\t\tvar m = expr.match(RX)||[];\n\t\tm.forEach(token=>{\n\t\t\tvar idx = expr.indexOf(token);\n\t\t\tvar t = expr.substring(0,idx);\n\t\t\tvar rtoken = token.replace(RX_RPL_TOKEN,\"\");\n\t\t\texpr = expr.substring(idx+token.length);\n\t\t\tlist.push(t);\n\t\t\tlist.push(function(entry){\n\t\t\t\treturn method(entry,rtoken);\n\t\t\t});\n\t\t});\n\t\tlist.push(expr);\n\t\tlist = list.filter(l=>l!=\"\");\n\t\tlen = list.length;\n\n\t\tif(len>1) {\n\t\t\treturn function(entry) {\n\t\t\t\tlet ret = \"\";\n\t\t\t\tfor(let i=0;i<len;i++) {\n\t\t\t\t\tlet t = list[i];\n\t\t\t\t\tret += typeof(t)==\"string\"? t : t(entry);\n\t\t\t\t}\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\treturn function(entry) {\n\t\t\t\tlet t = list[0];\n\t\t\t\treturn typeof(t)==\"string\"? t : t(entry);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction jsontokens(json) {\n\t\tlet ops = [], len = 0;\n\n\t\tfunction walk(json,path) {\n\t\t\tif(!json) return;\n\t\t\tObject.keys(json).forEach(k=>{\n\t\t\t\tlet newpath = `${path}${path?'.':''}${k}`;\n\t\t\t\tlet t = json[k];\n\t\t\t\tif(typeof(t)==\"string\") {\n\t\t\t\t\tops.push({path:newpath,fn:tokens(t)});\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\twalk(t,newpath);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\twalk(json,\"\");\n\t\tlen = ops.length;\n\n\t\treturn function(entry) {\n\t\t\tlet map = {};\n\t\t\tfor(let i=0;i<len;i++) {\n\t\t\t\tlet op = ops[i];\n\t\t\t\tmap[op.path] = op.fn(entry);\n\t\t\t}\n\t\t\treturn EVALS.valwalk(extend(true,{},json),map,\"\");\n\t\t}\n\t}\n\n\tfunction exprfn(input,replace){\n\t\tif(typeof(input)=='number') {\n\t\t\treturn function(obj){return input};\n\t\t}\n\t\telse if(typeof(input)==\"object\") {\n\t\t\treturn jsontokens(input,replace);\n\t\t}\n\t\telse {\n\t\t\treturn tokens(input);\n\t\t}\n\t}\n\n\treturn {\n\t\tfn : parse,\n\t\teval : parse,\n\t\tassign : fnassign,\n\t\texpr : exprfn,\n\t\texpression : exprfn\n\t}\n}\n\nmodule.exports = instance;\n\n},{\"extend\":5}],4:[function(require,module,exports){\nlet expression = require('./expression');\n\nlet instance = expression('$');\ninstance.newInstance = function(token) {\n\treturn expression(token);\n}\n\nmodule.exports = instance;\n\n},{\"./expression\":3}],5:[function(require,module,exports){\n'use strict';\n\nvar hasOwn = Object.prototype.hasOwnProperty;\nvar toStr = Object.prototype.toString;\nvar defineProperty = Object.defineProperty;\nvar gOPD = Object.getOwnPropertyDescriptor;\n\nvar isArray = function isArray(arr) {\n\tif (typeof Array.isArray === 'function') {\n\t\treturn Array.isArray(arr);\n\t}\n\n\treturn toStr.call(arr) === '[object Array]';\n};\n\nvar isPlainObject = function isPlainObject(obj) {\n\tif (!obj || toStr.call(obj) !== '[object Object]') {\n\t\treturn false;\n\t}\n\n\tvar hasOwnConstructor = hasOwn.call(obj, 'constructor');\n\tvar hasIsPrototypeOf = obj.constructor && obj.constructor.prototype && hasOwn.call(obj.constructor.prototype, 'isPrototypeOf');\n\t// Not own constructor property must be Object\n\tif (obj.constructor && !hasOwnConstructor && !hasIsPrototypeOf) {\n\t\treturn false;\n\t}\n\n\t// Own properties are enumerated firstly, so to speed up,\n\t// if last one is own, then all properties are own.\n\tvar key;\n\tfor (key in obj) { /**/ }\n\n\treturn typeof key === 'undefined' || hasOwn.call(obj, key);\n};\n\n// If name is '__proto__', and Object.defineProperty is available, define __proto__ as an own property on target\nvar setProperty = function setProperty(target, options) {\n\tif (defineProperty && options.name === '__proto__') {\n\t\tdefineProperty(target, options.name, {\n\t\t\tenumerable: true,\n\t\t\tconfigurable: true,\n\t\t\tvalue: options.newValue,\n\t\t\twritable: true\n\t\t});\n\t} else {\n\t\ttarget[options.name] = options.newValue;\n\t}\n};\n\n// Return undefined instead of __proto__ if '__proto__' is not an own property\nvar getProperty = function getProperty(obj, name) {\n\tif (name === '__proto__') {\n\t\tif (!hasOwn.call(obj, name)) {\n\t\t\treturn void 0;\n\t\t} else if (gOPD) {\n\t\t\t// In early versions of node, obj['__proto__'] is buggy when obj has\n\t\t\t// __proto__ as an own property. Object.getOwnPropertyDescriptor() works.\n\t\t\treturn gOPD(obj, name).value;\n\t\t}\n\t}\n\n\treturn obj[name];\n};\n\nmodule.exports = function extend() {\n\tvar options, name, src, copy, copyIsArray, clone;\n\tvar target = arguments[0];\n\tvar i = 1;\n\tvar length = arguments.length;\n\tvar deep = false;\n\n\t// Handle a deep copy situation\n\tif (typeof target === 'boolean') {\n\t\tdeep = target;\n\t\ttarget = arguments[1] || {};\n\t\t// skip the boolean and the target\n\t\ti = 2;\n\t}\n\tif (target == null || (typeof target !== 'object' && typeof target !== 'function')) {\n\t\ttarget = {};\n\t}\n\n\tfor (; i < length; ++i) {\n\t\toptions = arguments[i];\n\t\t// Only deal with non-null/undefined values\n\t\tif (options != null) {\n\t\t\t// Extend the base object\n\t\t\tfor (name in options) {\n\t\t\t\tsrc = getProperty(target, name);\n\t\t\t\tcopy = getProperty(options, name);\n\n\t\t\t\t// Prevent never-ending loop\n\t\t\t\tif (target !== copy) {\n\t\t\t\t\t// Recurse if we're merging plain objects or arrays\n\t\t\t\t\tif (deep && copy && (isPlainObject(copy) || (copyIsArray = isArray(copy)))) {\n\t\t\t\t\t\tif (copyIsArray) {\n\t\t\t\t\t\t\tcopyIsArray = false;\n\t\t\t\t\t\t\tclone = src && isArray(src) ? src : [];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tclone = src && isPlainObject(src) ? src : {};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Never move original objects, clone them\n\t\t\t\t\t\tsetProperty(target, { name: name, newValue: extend(deep, clone, copy) });\n\n\t\t\t\t\t// Don't bring in undefined values\n\t\t\t\t\t} else if (typeof copy !== 'undefined') {\n\t\t\t\t\t\tsetProperty(target, { name: name, newValue: copy });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Return the modified object\n\treturn target;\n};\n\n},{}]},{},[1]);\n"]}